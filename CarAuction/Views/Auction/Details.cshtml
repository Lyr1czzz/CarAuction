@model CarAuction.Controllers.AuctionController.AuctionViewModel

<h1>Аукцион</h1>

<div id="current-lot">
    <h2>Текущий лот: @Model.CurrentLot.Vehicle.Make.Name @Model.CurrentLot.Vehicle.Model.Name</h2>
    <img src="@Url.Content(Model.CurrentLot.Vehicle.Images.FirstOrDefault().ImagePath)" alt="Изображение автомобиля">
    <p>Текущая ставка: @Model.CurrentBid</p>
    <button id="place-bid" data-lot-id="@Model.CurrentLot.Id">Повысить ставку</button>
    <p>Осталось времени: <span id="timer">@Model.RemainingTime</span> сек.</p>
</div>

<div id="next-lots">
    <h2>Следующие лоты:</h2>
    <ul>
        @foreach (var lot in Model.NextLots)
        {
            <li>@lot.Vehicle.Make.Name @lot.Vehicle.Model.Name</li>
        }
    </ul>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/auctionHub")
            .build();

        connection.on("UpdateBid", (lotId, amount, auctionDate) => {
            if (lotId === @Model.CurrentLot.Id) {
                $("#current-bid").text(amount);
                // Обновить информацию о ставке
            }
        });

        connection.on("ResetTimer", () => {
            $("#timer").text(10);
            // Запустить таймер
        });

        connection.start().then(() => {
            $("#place-bid").click(() => {
                const lotId = $(this).data("lot-id");
                const amount = @Model.CurrentBid + 50;
                connection.invoke("PlaceBid", lotId, amount);
            });
        });
    </script>
}